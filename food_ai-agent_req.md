# Food AI Agent 기능명세서 (급식단체업체용)
- **문서명**: food_ai-agent_req.md  
- **버전**: 1.0.0  
- **작성일**: 2026-02-23 (Asia/Seoul)  
- **대상**: 위탁급식/단체급식 운영사(다현장 운영 기준)  
- **목표**: 메뉴(영양/알레르겐)–구매(단가/발주)–생산(레시피/공정)–배식(수요/잔반)–위생(HACCP)–클레임(개선) 전 과정을 AI Agent로 연결

---

## 0. 용어 정의
- **현장(Site)**: 급식 운영 사업장(학교/기업/병원 등)
- **식수(Forecast/Headcount)**: 예정/실제 제공 인원
- **식단(Menu Plan)**: 특정 기간(일/주/월) 메뉴 편성표(조/중/석 등)
- **표준레시피(Standard Recipe)**: 기준 인분/원재료/BOM/공정/CCP가 포함된 레시피
- **BOM(소요량)**: 식단 확정 후 품목별 필요 수량
- **CCP**: HACCP 중요관리점(온도/시간 등)
- **알레르겐(Allergen)**: 표시 대상 알레르기 유발 성분(법/고객 요구 포함)
- **클레임(Claim)**: 맛/이물/온도/양/서비스 등 불만 및 사고 대응 기록
- **Agent**: 사용자의 질문/업무 요청을 이해하고 문서(RAG)와 도구(Tool)를 호출하여 실행까지 돕는 시스템

---

## 1. 시스템 개요
### 1.1 제품 컨셉(한 줄)
> 급식 운영의 의사결정과 실행(식단·발주·조리·위생·CS)을 “대화 + 자동화 워크플로우”로 끝내는 운영 두뇌

### 1.2 사용자/권한(역할)
| 역할 | 약어 | 주요 책임 | 주요 권한 |
|---|---|---|---|
| 영양사/메뉴팀 | NUT | 식단 편성, 영양/알레르겐 검증, 레시피 표준화 | 식단 생성/수정/확정(승인 전), 레시피 조회/제안 |
| 구매/발주 | PUR | 단가/벤더 관리, 발주, 납품 리스크 대응 | 품목/단가 조회, 발주서 생성/수정, 벤더 비교 |
| 조리/생산(키친) | KIT | 생산계획, 조리 실행, 공정/CCP 기록 | 작업지시서 조회, 조리 Q&A, 공정 체크 |
| 위생/HACCP | QLT | 점검표/기록/감사 대응, 위해 이벤트 대응 | 점검표 생성/검토, 이력 조회, 사고 플로우 실행 |
| 운영/관리(센터) | OPS | 다현장 KPI, 원가/잔반/만족도, 표준화/통제 | 대시보드/리포트, 정책/템플릿 관리 |
| CS/영업 | CS | 클레임 대응/분석, 제안서/보고서 | 클레임 등록/분류, 리포트/문서 생성 |
| 시스템 관리자 | ADM | 마스터 데이터/연동/권한 | 전체 설정, 사용자/권한/연동 관리 |

> **권한 원칙**: “생성/추천”은 넓게, “확정/발주/공식 기록”은 승인 워크플로우 기반으로 제한

---

## 2. 범위(스코프)
### 2.1 포함(In Scope)
- 주간/월간 식단 생성 및 검증(영양/알레르겐/편중/다양성)
- 표준레시피 RAG + 인분 스케일링 + 작업지시서 생성
- 식단→BOM→발주 초안 생성(단가/벤더 반영)
- 수요 예측(기본: 과거 실적/계획 인원/요일, 확장: 이벤트/날씨)
- HACCP 점검표/CCP 기록 템플릿 + 누락 방지
- 클레임 분류/원인분석/재발방지 액션 연결
- 감사/추적(Audit Log) 및 근거(출처 문서/데이터) 기록

### 2.2 제외(Out of Scope, 초기)
- 결제/정산(매출, 세금계산서)
- 실시간 IoT 센서 연동(온도계/저울 등) — 단, 향후 확장 고려
- 외부 레시피 콘텐츠 원문 제공(저작권 리스크) — 요약/링크/출처 관리로 대체

---

## 3. 목표 KPI(지표)
- **원가율 개선**: 메뉴/대체품 추천을 통한 원가 상승 억제
- **잔반률 감소**: 수요 예측 및 선호 반영
- **결품/긴급발주 감소**: BOM 정확도 및 리스크 알림
- **HACCP 누락률 감소**: 체크리스트 자동화 + 알림
- **클레임 재발률 감소**: 원인-조치-학습 루프 구축
- **현장 커뮤니케이션 시간 감소**: 역할 간 핸드오프 자동화

---

## 4. 사용자 여정(대표 시나리오)
### 4.1 식단 편성→확정→발주
1) NUT: “다음주 A현장(350식) 중식 5일, 저염/원가 타이트” 요청  
2) Agent: 식단 2안 생성 → 영양/알레르겐 검증 → 원가/리스크 표시  
3) OPS/NUT: 확정(승인)  
4) PUR: BOM 자동 산출 → 발주 초안 생성 → 벤더/단가 비교 → 발주 확정  
5) KIT: 작업지시서(공정/CCP) 수신 및 조리 실행

### 4.2 단가 급등/납품 불가 대응
1) PUR: “양파 단가 급등/납품 지연” 등록  
2) Agent: 영향 메뉴/소요량/원가 상승 추정 → 대체품/메뉴 스왑 제안  
3) NUT/OPS: 변경 승인  
4) PUR: BOM 재산출 → 발주 수정

### 4.3 위생/사고 대응
1) QLT: “생선 비린내 민원” 발생  
2) Agent: 격리/검수/기록/벤더 통보/대체 메뉴 안내  
3) HACCP 기록 자동 생성 및 감사 리포트 출력

### 4.4 클레임 분석→재발방지
1) CS: “짜다 클레임 3일 연속”  
2) Agent: 데이터 기반 가설 제시(레시피 버전/염도 기록/로트 변경/교육)  
3) 조치 계획/교육 체크/레시피 수정안 제안 → 적용 및 추적

---

## 5. 기능 요구사항(Functional Requirements)
> 표기 규칙: **FR-영역-번호** (예: FR-MENU-001)

### 5.1 공통(대화/업무 실행/근거)
- **FR-COM-001** 대화형 요청 처리(자연어)  
  - 입력: 텍스트(향후 음성 확장), 첨부(문서/표/사진)  
  - 출력: 요약 + 선택지 + 실행 액션(버튼/체크리스트)
- **FR-COM-002** 의도 분류(Intent Router)  
  - 메뉴/영양/알레르겐/발주/재고/위생/클레임/리포트 등 자동 분류
- **FR-COM-003** 근거/출처 표시  
  - RAG 문서/데이터 소스(레시피 버전, 단가 시점, 현장 룰) 표시
- **FR-COM-004** 승인/결재 워크플로우 연동  
  - “추천/초안”과 “확정/공식기록”을 구분  
  - 승인자, 승인시간, 변경사유 기록
- **FR-COM-005** 감사 로그(Audit Log)  
  - 누가/언제/무엇을/왜 변경했는지 및 사용한 근거를 자동 기록

---

### 5.2 식단/영양/알레르겐(메뉴팀)
- **FR-MENU-001** 주간/월간 식단 자동 생성  
  - 입력: 현장, 기간, 식사(조/중/석), 식수, 예산/원가 목표, 선호/금기, 운영 룰  
  - 출력: 식단안(최소 2안), 메뉴 구성(메인/국/반찬/후식)
- **FR-MENU-002** 영양 기준 검증(정책 기반)  
  - 지표: 칼로리/단백질/나트륨/당/지방 등(현장별 설정)  
  - 미달/초과 항목 강조 및 보정 추천(대체 반찬/조리법 변경)
- **FR-MENU-003** 알레르겐 자동 태깅 및 표기문구 생성  
  - 메뉴/레시피/원재료에서 알레르겐 추출  
  - 법정 표시 + 고객사 추가 룰을 함께 적용
- **FR-MENU-004** 다양성/편중 감지  
  - 튀김 빈도, 동일 식재료 반복, 조리법 편중 등을 자동 경고
- **FR-MENU-005** 고객사 룰 엔진  
  - 예: “매주 1회 생선”, “돼지고기 금지”, “맵기 레벨 제한” 등 룰 적용
- **FR-MENU-006** 식단 확정 및 버전 관리  
  - 식단 버전(초안/검토/확정) 관리, 변경 이력, 롤백 지원

---

### 5.3 표준레시피/조리(키친)
- **FR-RECP-001** 표준레시피 검색(RAG)  
  - SOP/표준서/기존 레시피 문서에서 최적 결과 반환(하이브리드 검색 권장)
- **FR-RECP-002** 인분 스케일링(대량조리)  
  - 기준 인분 → 목표 인분(예: 350식) 자동 환산  
  - 조미료/염도 보정 가이드 포함(대량조리 특성 반영)
- **FR-RECP-003** 작업지시서(생산 오더) 자동 생성  
  - 조리 순서, 동시 작업, 설비 제약, 마감 시각 기반 일정 제안
- **FR-RECP-004** 조리 중 Q&A/트러블슈팅  
  - 예: “너무 짜다/되다/묽다”, “야채 상태 불량” → 즉시 보정/대체 제안
- **FR-RECP-005** CCP 체크 항목 포함  
  - 온도/시간/보관 조건 등 중요관리점을 공정 단계에 삽입

---

### 5.4 수요 예측/잔반 최적화
- **FR-FCST-001** 식수 예측(기본 모델)  
  - 입력: 과거 제공 실적, 계획 인원, 요일  
  - 출력: 예측 식수(범위) + 신뢰도 + 리스크 요인
- **FR-FCST-002** 잔반/인기 피드백 루프  
  - 메뉴별 잔반률/선호도를 반영해 이후 식단 추천에 적용
- **FR-FCST-003** 이벤트/휴무/행사 반영(확장)  
  - 캘린더/현장 이벤트 데이터 입력 시 예측 보정

---

### 5.5 BOM/구매/발주(구매팀)
- **FR-PUR-001** 식단 확정 → BOM 자동 산출  
  - 메뉴별 레시피→원재료 소요량 집계(현장/기간/식수 반영)
- **FR-PUR-002** 단가/벤더 이력 조회 및 반영  
  - 품목별 단가 추이, 벤더별 납기/품질 지표 조회
- **FR-PUR-003** 발주 초안 자동 생성  
  - 품목/규격/수량/납기/현장 정보를 포함한 발주서 초안 생성
- **FR-PUR-004** 단가 급등/공급 리스크 감지 및 알림  
  - 임계치(예: 전주 대비 +15%) 초과 시 경고  
  - 영향 식단/원가 상승 추정 및 대체안 자동 제시
- **FR-PUR-005** 대체품/벤더 추천  
  - 동일 품목의 대체 규격/대체 식재군 추천(알레르겐/품질 룰 반영)
- **FR-PUR-006** 발주 승인/변경 관리  
  - 발주 확정 전 승인, 변경 시 영향(BOM/원가/메뉴) 재계산

---

### 5.6 재고/입고/검수/추적(Traceability)
- **FR-INV-001** 재고 조회 및 사용 계획 반영  
  - 재고/유통기한/로트 기반으로 BOM에서 우선 사용 추천
- **FR-INV-002** 입고/검수 체크리스트  
  - 품질 기준(신선도/온도/포장 등) 점검 항목 제공 및 기록
- **FR-INV-003** 로트 추적(납품→사용 메뉴/일자/현장)  
  - 사고/클레임 발생 시 영향 범위(어느 메뉴/현장/일자) 역추적

---

### 5.7 위생/HACCP/감사 대응
- **FR-HAC-001** 일일/주간 점검표 자동 생성  
  - 현장/식사/공정에 맞는 체크리스트 템플릿 제공
- **FR-HAC-002** CCP 기록(온도/시간) 입력 가이드  
  - 누락 방지 알림(마감 전 체크)  
  - 첨부(사진) 지원(옵션)
- **FR-HAC-003** 위해 의심 이벤트 대응 플로우  
  - 보존식/검체/격리/보고/벤더 통보/대체 메뉴 등 단계 안내  
  - 실행 로그 자동 기록
- **FR-HAC-004** 감사 리포트 출력  
  - 기간/현장 선택 → 점검/CCP/교육/검수/클레임 이력 패키징

---

### 5.8 클레임/품질/개선(운영/CS)
- **FR-CLM-001** 클레임 접수 및 자동 분류  
  - 유형: 맛/이물/온도/양/서비스/위생/기타  
  - 심각도(레벨) 자동 제안
- **FR-CLM-002** 원인 분석 지원(가설+증빙 요청)  
  - 레시피 버전, 로트, CCP 기록, 교육 이력, 조리자 교대 등 점검 포인트 제공
- **FR-CLM-003** 조치/재발방지 액션 관리  
  - 액션 항목 생성(교육/레시피 수정/벤더 변경/공정 변경)  
  - 담당자/기한/완료 여부 추적
- **FR-CLM-004** 클레임 리포팅  
  - 현장별 Top 이슈, 재발률, 평균 처리시간, 벤더 연관 분석

---

### 5.9 대시보드/리포트(OPS)
- **FR-RPT-001** 운영 대시보드(오늘/이번주)  
  - 예상 식수, 결품 위험, 단가 급등 품목, HACCP 누락 위험, 클레임 알림
- **FR-RPT-002** KPI 리포트(현장별/기간별)  
  - 원가율, 잔반률, 만족도(있다면), 클레임률, 벤더 품질 지표
- **FR-RPT-003** 제안서/보고서 초안 생성(CS/영업)  
  - 샘플 식단, 운영계획, 원가 시뮬레이션(가능 범위) 포함

---

## 6. 화면/메뉴(IA) 제안
1) **운영 대시보드**  
2) **식단 설계실**(생성/검증/확정/버전)  
3) **레시피 라이브러리**(표준레시피/SOP/RAG 검색)  
4) **BOM & 발주**(소요량/발주서/승인)  
5) **생산/조리 모드**(작업지시서/공정/CCP/질문)  
6) **재고/입고/검수**(로트/유통기한/검수 기록)  
7) **위생/HACCP**(점검표/감사 리포트)  
8) **클레임 센터**(접수/분석/조치/재발방지)  
9) **성과 분석**(KPI/벤더 스코어)  
10) **설정/마스터/권한**(현장 룰/알레르겐 정책/템플릿)

---

## 7. 데이터 요구사항(핵심 엔티티)
### 7.1 마스터
- **Site**: 현장 정보(인원, 운영시간, 설비, 고객 룰)
- **Item**: 식재료 마스터(규격, 알레르겐, 보관조건, 대체군)
- **Vendor**: 협력사(납기/품질/단가 이력)
- **Policy**: 영양 기준/알레르겐 표시/금기 룰

### 7.2 운영
- **MenuPlan**: 식단(버전, 상태, 승인)
- **Recipe**: 표준레시피(버전, 공정, CCP)
- **BOM**: 기간/현장 소요량(계산 근거 포함)
- **PurchaseOrder**: 발주서(상태/승인/변경)
- **Inventory/Inbound/Inspection**: 재고/입고/검수(로트/유통기한)
- **HACCPLog**: 점검표/CCP 기록/교육/보존식
- **Forecast**: 식수 예측/실적
- **Claim**: 클레임/조치/재발방지
- **AuditLog**: 모든 주요 변경 이력(근거 포함)

---

## 8. 연동(Integration) 요구사항
- **ERP/구매 시스템**: 품목/발주/입고/재고(가능 범위부터 단계적)
- **식수 데이터**: 출석/예약/인원 계획(현장 입력 또는 시스템 연동)
- **클레임 채널**: 콜/앱/설문/메신저(선택)
- **BI/데이터웨어하우스**: KPI 대시보드(선택)
- **문서 저장소**: SOP/HACCP 문서, 표준레시피 문서(버전 관리)

---

## 9. 비기능 요구사항(NFR)
- **NFR-001 성능**: 대시보드/검색 주요 화면 3초 이내 응답(캐시/인덱스 활용)
- **NFR-002 가용성**: 현장 운영 시간대 장애 최소화(모니터링/알림)
- **NFR-003 보안**: 역할 기반 접근제어(RBAC), 데이터 암호화(전송/저장)
- **NFR-004 개인정보/민감정보 최소화**: 인원/선호 정보는 집계 수준 권장
- **NFR-005 변경관리**: 레시피/식단/정책 버전관리 및 롤백
- **NFR-006 추적성**: 모든 확정/발주/위생 기록에 감사 로그 필수
- **NFR-007 신뢰성**: AI 결과는 “근거/가정/리스크”를 함께 제공
- **NFR-008 저작권/출처**: 외부 레시피 원문 복제 금지, 요약/링크/출처 정책 적용

---

## 10. 안전/컴플라이언스 가드레일
- **SAFE-001 알레르겐**: 미확인 시 “확인 필요”로 보수적 안내 + 표기 누락 방지
- **SAFE-002 식중독/위해**: 의심 이벤트는 즉시 대응 플로우 제시(격리/보고/기록)
- **SAFE-003 대량조리**: 인분 스케일링 시 조미료/염도 보정 가이드 필수
- **SAFE-004 승인 전 확정 금지**: 식단/발주/공식 기록은 승인 단계 없이는 확정 불가
- **SAFE-005 문서 근거 우선**: 내부 SOP/HACCP 문서가 있을 경우 이를 최우선 근거로 사용
- **SAFE-006 리스크 알림**: 단가 급등, 유통기한 임박, 검수 불량 등 운영 리스크를 대시보드에 상시 노출

---

## 11. MVP 단계(권장 로드맵)
### MVP 1 (식단-검증-문서화)
- 식단 생성/영양/알레르겐 검증
- 표준레시피 RAG + 작업지시서
- HACCP 점검표 템플릿 + 누락 방지

### MVP 2 (BOM/발주 자동화)
- 식단 확정→BOM 산출→발주 초안
- 단가/벤더 반영, 리스크 알림, 대체안

### MVP 3 (수요 예측/잔반 최적화)
- 기본 예측 + 잔반/선호 피드백 루프

### MVP 4 (클레임/품질/벤더 운영)
- 클레임 분류/원인/조치/재발방지
- 벤더 품질 스코어링

---

## 12. 산출물/템플릿 목록(시스템 내 관리)
- 식단 생성 프롬프트/룰 템플릿(현장별)
- 영양 기준 정책 템플릿
- 알레르겐 표시 정책 템플릿
- 표준레시피 템플릿(원재료/BOM/공정/CCP)
- 작업지시서 템플릿
- 입고/검수 체크리스트 템플릿
- HACCP 점검표/CCP 기록 템플릿
- 위해 이벤트 대응 템플릿
- 클레임 대응/보고 템플릿
- 감사 리포트 템플릿

---

## 13. 오픈 이슈(설계 시 결정 필요)
1) 고객사/현장별 영양 기준의 표준(범위/지표)  
2) 알레르겐 표시 범위(법정 + 고객 추가 룰)  
3) ERP/구매/재고 연동 범위(1차 MVP는 파일/CSV 연동도 가능)  
4) 레시피/문서 수집 및 버전관리 방식(승인 체계 포함)  
5) 수요 예측 입력 변수(출석/예약/이벤트/날씨) 우선순위  
6) 다현장 표준화 수준(현장 자율 vs 중앙 통제)  

---

### 부록 A. 기능 ID 인덱스(요약)
- COM: 001~005 (대화/근거/승인/감사)
- MENU: 001~006 (식단/영양/알레르겐/룰/버전)
- RECP: 001~005 (레시피/RAG/스케일/작업지시/CCP)
- FCST: 001~003 (예측/잔반/이벤트)
- PUR: 001~006 (BOM/단가/발주/리스크/대체/승인)
- INV: 001~003 (재고/검수/추적)
- HAC: 001~004 (점검/CCP/이벤트/감사리포트)
- CLM: 001~004 (클레임/분류/원인/조치/리포트)
- RPT: 001~003 (대시보드/KPI/문서)
